# DigitalSpadArraySimulator
 * Copyright (C) 2016
 *
 * ***********************************************************************
 * This file is part of SpadSimulator/DigitalSpadArraySimulator
 *
 * SpadSimulator is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * SpadSimulator is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with SpadSimulator.  If not, see <http://www.gnu.org/licenses/>.
 * ***********************************************************************
 *
 * Author      : Audrey Corbeil Therrien <audrey.corbeil.therrien@usherbrooke.ca>
 * Author      : Valentin Libioulle <valentin.libioulle@usherbrooke.ca>
 * Supervisor  : Jean-François Pratte <jean-francois.pratte@usherbrooke.ca>
 * Supervisor  : Réjean Fontaine <rejean.fontaine@usherbrooke.ca>
 * Created     : Mon Oct 17 16:57:33 2016 -0500 by audrey


REQUIREMENTS
CMake 3.2 or later
gcc 4.8.2 or later  (need c++11 support)
root 5.34.34 or later
Previous versions may work, but have not been tested.

If the use of this simulator results in published work (paper, conference presentation, poster, etc.),
please add the following reference to your citations.
Thank You!

A. C. Therrien, V. Libioulle, S. A. Charlebois, R. Fontaine, J.-F. Pratte.  "SPAD Array Simulator:
Release and Distribution", IEEE Nuclear Science Symposium and Medical Iamging Conference, 2016,
N38-4, november 2 2016.

(Article to be announced)

# Quick start

1. Requirements
  4 CMake 3.2 or later
  5 gcc 4.8.2 or later (need c++11 support)
  6 root 5.34.24 or later
Previous versions may work, but have not been tested.

2. Build

To build the project, you will need CMake.
You also need to have Root on your computer and you need "source" it. 
See Step 6 of the Quick Start on this page: https://root.cern.ch/installing-root-source 

Available CMake parameters:
    CMAKE_BUILD_TYPE --> RELEASE or DEBUG (Default=RELEASE)

    GEN_DOXY         --> ON or OFF
        Will Generate the documentation Doxygen if ON.
        -DGEN_DOXY={ON or OFF}

    VERBOSE          --> ON or OFF
        Will ouput execution info if ON.
        -DVERBOSE={ON or OFF}

After the CMake command, execute "make -j{number_of_building_process}" in your build directory.


3. The config

The executable "Timestamps" has been generated during step 1.
Now to launch it, you need to give it a Configuration file.

In the project folder you should see a "example.cfg" file.
This file contains an example of a valid configuration.

The minimum parameters are the following:
    event_importer
    event_file
    simulator_config_importer
    simulator_config_file
    simulation_exporter
    simulation_file
    batch_size

Every other parameters have a default value.
You will find a description of every parameters in the example file.

4. The event_importer

4.1 RootEventImporter

The RootEventImporter was designed to import data generated by g4matrix project. (https://github.com/marcopizzichemi/g4matrix)
But you can produce a root file yourself.
You will need the following structure:
    TTree named "tree"
        TBranch named "GlobalTime"    composed of std::vector<float> (ns)
        TBranch named "PositionX"     composed of std::vector<float> (um)
        TBranch named "PositionY"     composed of std::vector<float> (um)
        TBranch named "PostMomentumX" composed of std::vector<float> (unit Vector)
        TBranch named "PostMomentumY" composed of std::vector<float> (unit Vector)
        TBranch named "PostMomentumZ" composed of std::vector<float> (unit Vector)
        TBranch named "PhotonType"    composed of std::vector<int>   (1=Photon,11=Cherenkov,21=Prompt)
        TBranch named "PhotonEnergy"  composed of std::vector<float> (eV)

4.2 CsvEventImporter

The CsvEventImporter was designed to offer an alternative to the Root file.
You will need to use the following structure:
float;float;float;float;float;float;int;float
The parameter order is the same used in RootEventImporter.
The requires Full path!

4.3 LaserEventImporter

The LaserEventImporter was designed to generate photons that hit matrix at the same time.
Instead of providing the parameter event_file, you will have to provide the two following parameters in the .cfg file.
laser_photons_per_event
laser_wavelength

5. The simulator_config_importer

5.1 ExcelConfigImporter

The ExcelConfigImporter was designed to import many config sets in a single file.
The file should have the following sheet:
    Matrix --> The SensorMatrix Configuration
    Quench --> The Quench Configuration
    Sensor --> The Sensors Configuration
    Silicon -> The Silicon Configuration
The first column should contain a string with the PropertyName.
The second column should contain the PropertyValue.
The sheets should not have a header row since the importer start at row 1.
See the code documentation for details for each configuration.

6. The Simulation

You are ready to run a simulation.
/path/to/Timestamps /path/to/{config_file}.cfg
